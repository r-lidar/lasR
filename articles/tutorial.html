<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="lasR">
<title>Tutorial • lasR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Tutorial">
<meta property="og:description" content="lasR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">lasR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.4</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Presentation</h6>
    <a class="dropdown-item" href="../articles/why.html">Why lasR?</a>
    <a class="dropdown-item" href="../articles/benchmarks.html">Benchmarks of lasR vs. lidR</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Tutorials</h6>
    <a class="dropdown-item" href="../articles/tutorial.html">Tutorial</a>
    <a class="dropdown-item" href="../articles/multithreading.html">Parallel processing</a>
    <a class="dropdown-item" href="../articles/baba.html">Buffered Area Based Approach</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Ressources</h6>
    <a class="dropdown-item" href="../articles/pipeline.html">Pipelines</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/r-lidar/lasR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Tutorial</h1>
                        <h4 data-toc-skip class="author">Jean-Romain
Roussel</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/r-lidar/lasR/blob/HEAD/vignettes/tutorial.Rmd" class="external-link"><code>vignettes/tutorial.Rmd</code></a></small>
      <div class="d-none name"><code>tutorial.Rmd</code></div>
    </div>

    
    
<p>This tutorial is intended to be read in order. It introduces the
available tools of the package in a specific order so that the reader
can discover all the features of the package organically.</p>
<blockquote style="background-color: #d6e9f9; border-left: 5px solid #428bca; padding: 10px;font-size: 14px; border-radius: 5px;">
In the following tutorial, the variable <code>f</code> refers to one or
several file paths stored in a vector. It can also be the path to a
directory or the path of a <a href="https://www.lutraconsulting.co.uk/blog/2023/06/08/virtual-point-clouds/" class="external-link">virtual
point cloud</a>. In this tutorial, the output is rendered with one or
two small LAS files, but every pipeline is designed to process numerous
files covering a large extent.
</blockquote>
<div class="section level2">
<h2 id="overall-functionality">Overall functionality<a class="anchor" aria-label="anchor" href="#overall-functionality"></a>
</h2>
<p>In <code>lasR</code>, the R functions provided to the user are not
designed to process the data directly; instead, they are used to create
a pipeline. A pipeline consists of stages that are applied to a point
cloud in order. Each stage can either transform the point cloud within
the pipeline without generating any output or process the point cloud to
produce an output.</p>
<p>In the figure below, there are 4 LAS/LAZ files and a pipeline that
(1) reads a file, (2) builds and writes a DTM on disk, (3) transforms
the point cloud by normalizing the elevation, (4) builds a canopy height
model using the transformed point cloud, and (5) transforms the point
cloud by removing points below 5 m. The resulting version of the point
cloud (points above 5m) is discarded and lost because there is no
additional stage in this pipeline. However, other stages can be added,
such as the application of a predictive model for points above 5 m or a
stage that writes the point cloud to disk.</p>
<p>Once the first file completes the entire pipeline, the second file is
used, and the pipeline is applied to fill in the missing parts of the
geospatial rasters or vectors produced by the pipeline. Each file is
loaded with a buffer from neighboring files if needed.</p>
<p>A pipeline created from the R interface does nothing initially. After
building the pipeline, users must call the <code><a href="../reference/exec.html">exec()</a></code> function
on it to initiate the computation.</p>
<p><img src="pipeline.png"></p>
</div>
<div class="section level2">
<h2 id="reader">Reader<a class="anchor" aria-label="anchor" href="#reader"></a>
</h2>
<p>The <code><a href="../reference/reader_las.html">reader_las()</a></code> stage MUST be the first stage of any
pipeline (blue in the figure above). It takes as input the list of files
to process. When creating a pipeline with only this stage, the header of
the files are read, but no computation is actually applied. The points
are not even read because there is no other stage in the pipeline that
require to read the points. No result is returned.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pipeline</span> <span class="op">=</span> <span class="fu"><a href="../reference/reader_las.html">reader_las</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/exec.html">exec</a></span><span class="op">(</span><span class="va">pipeline</span>, on <span class="op">=</span> <span class="va">f</span><span class="op">)</span></span>
<span><span class="co">#&gt; NULL</span></span></code></pre></div>
<p>In practice when using <code>read_las()</code> without argument it
can be omitted, the function <code>exec</code> adds it on-the-fly.</p>
</div>
<div class="section level2">
<h2 id="triangulate">Triangulate<a class="anchor" aria-label="anchor" href="#triangulate"></a>
</h2>
<p>The first stage we can try is <code><a href="../reference/triangulate.html">triangulate()</a></code>. This
algorithm performs a Delaunay triangulation on the points of interest.
Triangulating points is a very useful task that is employed in numerous
processing tasks. Triangulating all points is not very interesting, so
we usually want to use the <code>filter</code> argument to triangulate
only specific points of interest.</p>
<p>In the following example, we triangulate the points classified as 2
(i.e., ground). This produces a meshed Digital Terrain Model.</p>
<p>In this example, the files are read sequentially, with points loaded
one by one and stored to build a Delaunay triangulation. In
<code>lasR</code>, only one file is stored in memory at a time. The
program stores the point cloud and the Delaunay triangulation for the
current processing file. Then the data are discarded to load a new
file.</p>
<p>If the users do not provide a path to an output file to store the
result, the result is lost. In the following pipeline, we are building a
triangulation of the ground points, but we get no output because
everything is lost.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pipeline</span> <span class="op">=</span> <span class="fu"><a href="../reference/reader_las.html">reader_las</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/triangulate.html">triangulate</a></span><span class="op">(</span>filter <span class="op">=</span> <span class="fu"><a href="../reference/filters.html">keep_ground</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ans</span> <span class="op">=</span> <span class="fu"><a href="../reference/exec.html">exec</a></span><span class="op">(</span><span class="va">pipeline</span>, on <span class="op">=</span> <span class="va">f</span><span class="op">)</span></span>
<span><span class="va">ans</span></span>
<span><span class="co">#&gt; NULL</span></span></code></pre></div>
<p>In the following pipeline the triangulation is stored in a geopackage
file by providing an argument <code>ofile</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pipeline</span> <span class="op">=</span> <span class="fu"><a href="../reference/reader_las.html">reader_las</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/triangulate.html">triangulate</a></span><span class="op">(</span>filter <span class="op">=</span> <span class="fu"><a href="../reference/filters.html">keep_ground</a></span><span class="op">(</span><span class="op">)</span>, ofile <span class="op">=</span> <span class="fu"><a href="../reference/temporary_files.html">tempgpkg</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ans</span> <span class="op">=</span> <span class="fu"><a href="../reference/exec.html">exec</a></span><span class="op">(</span><span class="va">pipeline</span>, on <span class="op">=</span> <span class="va">f</span><span class="op">)</span></span>
<span><span class="va">ans</span></span>
<span><span class="co">#&gt; Simple feature collection with 1 feature and 0 fields</span></span>
<span><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XYZ</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 273357.2 ymin: 5274357 xmax: 273642.9 ymax: 5274643</span></span>
<span><span class="co">#&gt; z_range:       zmin: 788.9932 zmax: 814.8322</span></span>
<span><span class="co">#&gt; Projected CRS: NAD83(CSRS) / MTM zone 7</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 1</span></span></span>
<span><span class="co">#&gt;                                                                             geom</span></span>
<span><span class="co">#&gt;                                                               <span style="color: #949494; font-style: italic;">&lt;MULTIPOLYGON [m]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Z (((273500.4 5274501 808.4787, 273501.2 5274502 808.1748, 273500.4 5274502 8…</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ans</span>, axes <span class="op">=</span> <span class="cn">T</span>, lwd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="tutorial_files/figure-html/triangulate2-1.png" width="480"></p>
<p>We can also triangulate the first returns. This produce a meshed
Digital Surface Model.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">read</span> <span class="op">=</span> <span class="fu"><a href="../reference/reader_las.html">reader_las</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">del</span> <span class="op">=</span> <span class="fu"><a href="../reference/triangulate.html">triangulate</a></span><span class="op">(</span>filter <span class="op">=</span> <span class="fu"><a href="../reference/filters.html">keep_first</a></span><span class="op">(</span><span class="op">)</span>, ofile <span class="op">=</span> <span class="fu"><a href="../reference/temporary_files.html">tempgpkg</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ans</span> <span class="op">=</span> <span class="fu"><a href="../reference/exec.html">exec</a></span><span class="op">(</span><span class="va">read</span><span class="op">+</span><span class="va">del</span>, on <span class="op">=</span> <span class="va">f</span><span class="op">)</span></span></code></pre></div>
<p>We can also perform both triangulations in the same pipeline. The
idea of <code>lasR</code> is to execute all the tasks in one pass using
a pipeline:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">read</span> <span class="op">=</span> <span class="fu"><a href="../reference/reader_las.html">reader_las</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">del1</span> <span class="op">=</span> <span class="fu"><a href="../reference/triangulate.html">triangulate</a></span><span class="op">(</span>filter <span class="op">=</span> <span class="fu"><a href="../reference/filters.html">keep_ground</a></span><span class="op">(</span><span class="op">)</span>, ofile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".gpkg"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">del2</span> <span class="op">=</span> <span class="fu"><a href="../reference/triangulate.html">triangulate</a></span><span class="op">(</span>filter <span class="op">=</span> <span class="fu"><a href="../reference/filters.html">keep_first</a></span><span class="op">(</span><span class="op">)</span>, ofile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".gpkg"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pipeline</span> <span class="op">=</span> <span class="va">read</span> <span class="op">+</span> <span class="va">del1</span> <span class="op">+</span> <span class="va">del2</span></span>
<span><span class="va">ans</span> <span class="op">=</span> <span class="fu"><a href="../reference/exec.html">exec</a></span><span class="op">(</span><span class="va">pipeline</span>, on <span class="op">=</span> <span class="va">f</span><span class="op">)</span></span></code></pre></div>
<p>Using <code><a href="../reference/triangulate.html">triangulate()</a></code> without any other stage in the
pipeline is usually not very useful. Typically,
<code><a href="../reference/triangulate.html">triangulate()</a></code> is employed without the <code>ofile</code>
argument as an intermediate step. For instance, it can be used with
<code><a href="../reference/rasterize.html">rasterize()</a></code>.</p>
</div>
<div class="section level2">
<h2 id="rasterize">Rasterize<a class="anchor" aria-label="anchor" href="#rasterize"></a>
</h2>
<p><code><a href="../reference/rasterize.html">rasterize()</a></code> does exactly what users may expect from it
and even more. There are three variations:</p>
<ol style="list-style-type: decimal">
<li>Rasterize with predefined operators. The operators are optimized
internally, making the operations as fast as possible, but the number of
registered operators is finite.</li>
<li>Rasterize by injecting a user-defined R expression. This is
equivalent to <code><a href="https://rdrr.io/pkg/lidR/man/aggregate.html" class="external-link">pixel_metrics()</a></code> from the package
<code>lidR</code>. Any user-defined function can be mapped, making it
extremely versatile but slower.</li>
<li>Rasterize a Delaunay triangulation.</li>
</ol>
<p>With these variations, users can build a CHM, a DTM, a predictive
model, or anything else.</p>
<div class="section level3">
<h3 id="rasterize---triangulation">Rasterize - triangulation<a class="anchor" aria-label="anchor" href="#rasterize---triangulation"></a>
</h3>
<p>Let’s build a DTM using a triangulation of the ground points and the
<code><a href="../reference/rasterize.html">rasterize()</a></code> stage. In the following pipeline, the LAS files
are read, points are loaded for each LAS file <strong>with a
buffer</strong>, a Delaunay triangulation of the ground points is built,
and then the triangulation is interpolated and rasterized. By default,
<code><a href="../reference/rasterize.html">rasterize()</a></code> writes the raster in a temporary file, so the
result is not discarded.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># omitting reader_las() for the example</span></span>
<span><span class="va">del</span> <span class="op">=</span> <span class="fu"><a href="../reference/triangulate.html">triangulate</a></span><span class="op">(</span>filter <span class="op">=</span> <span class="fu"><a href="../reference/filters.html">keep_ground</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dtm</span> <span class="op">=</span> <span class="fu"><a href="../reference/rasterize.html">rasterize</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">del</span><span class="op">)</span></span>
<span><span class="va">pipeline</span> <span class="op">=</span> <span class="va">del</span> <span class="op">+</span> <span class="va">dtm</span></span>
<span><span class="va">ans</span> <span class="op">=</span> <span class="fu"><a href="../reference/exec.html">exec</a></span><span class="op">(</span><span class="va">pipeline</span>, on <span class="op">=</span> <span class="va">f</span><span class="op">)</span></span>
<span><span class="va">ans</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; dimensions  : 286, 286, 1  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 1, 1  (x, y)</span></span>
<span><span class="co">#&gt; extent      : 273357, 273643, 5274357, 5274643  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : NAD83(CSRS) / MTM zone 7 (EPSG:2949) </span></span>
<span><span class="co">#&gt; source      : file224328bfe006.tif </span></span>
<span><span class="co">#&gt; name        : file224328bfe006</span></span></code></pre></div>
<p>Here, <code><a href="../reference/exec.html">exec()</a></code> returns a only one <code>SpatRaster</code>
because <code><a href="../reference/triangulate.html">triangulate()</a></code> returns nothing (<code>NULL</code>).
Therefore, the pipeline contains two stages, but only one returns
something.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ans</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/gray.colors.html" class="external-link">gray.colors</a></span><span class="op">(</span><span class="fl">25</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="tutorial_files/figure-html/plotdtm-1.png" width="700"></p>
<p>Notice that, contrary to the <code>lidR</code> package, there is
usually no high-level function with names like
<code><a href="https://rdrr.io/pkg/lidR/man/rasterize.html" class="external-link">rasterize_terrain()</a></code>. Instead, <code>lasR</code> is made up
of low-level functions that are more versatile but also more challenging
to use.</p>
</div>
<div class="section level3">
<h3 id="rasterize---internal-metrics">Rasterize - internal metrics<a class="anchor" aria-label="anchor" href="#rasterize---internal-metrics"></a>
</h3>
<p>Let’s build two CHMs: one based on the highest point per pixel with a
resolution of 2 meters, and the second based on the triangulation of the
first returns with a resolution of 50 cm.</p>
<p>In the following pipeline, we are using two variations of
<code><a href="../reference/rasterize.html">rasterize()</a></code>: one capable of rasterizing a triangulation and
the other capable of rasterizing the point cloud with a predefined
operator (here <code>max</code>). The output is a named
<code>list</code> with two <code>SpatRaster</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">del</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/triangulate.html">triangulate</a></span><span class="op">(</span>filter <span class="op">=</span> <span class="fu"><a href="../reference/filters.html">keep_first</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">chm1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rasterize.html">rasterize</a></span><span class="op">(</span><span class="fl">2</span>, <span class="st">"max"</span><span class="op">)</span></span>
<span><span class="va">chm2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rasterize.html">rasterize</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="va">del</span><span class="op">)</span></span>
<span><span class="va">pipeline</span> <span class="op">&lt;-</span> <span class="va">del</span> <span class="op">+</span> <span class="va">chm1</span> <span class="op">+</span> <span class="va">chm2</span></span>
<span><span class="va">ans</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/exec.html">exec</a></span><span class="op">(</span><span class="va">pipeline</span>, on <span class="op">=</span> <span class="va">f</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ans</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">col</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ans</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">col</span><span class="op">)</span></span></code></pre></div>
<p><img src="tutorial_files/figure-html/rasterize2-1.png" width="50%"><img src="tutorial_files/figure-html/rasterize2-2.png" width="50%"></p>
<blockquote style="background-color: #d6e9f9; border-left: 5px solid #428bca; padding: 10px;font-size: 14px; border-radius: 5px;">
For simplicity the package has pre-installed pipelines named
<code><a href="../reference/chm.html">chm()</a></code> and <code><a href="../reference/dtm.html">dtm()</a></code> that do what is explained
above.
</blockquote>
</div>
<div class="section level3">
<h3 id="rasterize---custom-metrics">Rasterize - custom metrics<a class="anchor" aria-label="anchor" href="#rasterize---custom-metrics"></a>
</h3>
<p>Last but not least, let’s compute the map of the median intensity by
injecting a user-defined expression. Like in <code>lidR</code>, the
attributes of the point cloud are named: <code>X</code>, <code>Y</code>,
<code>Z</code>, <code>Intensity</code>, <code>gpstime</code>,
<code>ReturnNumber</code>, <code>NumberOfreturns</code>,
<code>Classification</code>, <code>UserData</code>,
<code>PointSourceID</code>, <code>R</code>, <code>G</code>,
<code>B</code>, <code>NIR</code>. For users familiar with the
<code>lidR</code> package, note that there is no
<code>ScanAngleRank/ScanAngle</code>; instead the scanner angle is
always named <code>ScanAngle</code> and is numeric. Also flags are named
<code>Withheld</code>, <code>Synthetic</code> and
<code>Keypoint</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pipeline</span> <span class="op">=</span> <span class="fu"><a href="../reference/rasterize.html">rasterize</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">Intensity</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ans</span> <span class="op">=</span> <span class="fu"><a href="../reference/exec.html">exec</a></span><span class="op">(</span><span class="va">pipeline</span>, on <span class="op">=</span> <span class="va">f</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ans</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">heat.colors</a></span><span class="op">(</span><span class="fl">15</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="tutorial_files/figure-html/rasterize3-1.png" width="700"></p>
<p>Notice that, in this specific case, using
<code>rasterize(10, "imean")</code> is more efficient.</p>
</div>
<div class="section level3">
<h3 id="rasterize---buffered">Rasterize - buffered<a class="anchor" aria-label="anchor" href="#rasterize---buffered"></a>
</h3>
<blockquote style="background-color: #d6e9f9; border-left: 5px solid #428bca; padding: 10px;font-size: 14px; border-radius: 5px;">
The <code>lasR</code> package introduced the concept of a buffered
area-based approach to enhance the resolution of prediction maps.
However, this concept is not covered in detail in this tutorial. For
further information, readers can refer to the <a href="baba.html">dedicated article</a>
</blockquote>
</div>
</div>
<div class="section level2">
<h2 id="transform-with">Transform with<a class="anchor" aria-label="anchor" href="#transform-with"></a>
</h2>
<p>Another way to use a Delaunay triangulation is to transform the point
cloud. Users can add or subtract the triangulation from the point cloud,
effectively normalizing it. Unlike the <code>lidR</code> package, there
is no high-level function with names like
<code>normalize_points()</code>. Instead, <code>lasR</code> is composed
of low-level functions that offer more versatility.</p>
<p>Let’s normalize the point cloud using a triangulation of the ground
points (meshed DTM).</p>
<p>In the following example, the triangulation is used by
<code><a href="../reference/transform_with.html">transform_with()</a></code> that modifies the point cloud in the
pipeline. Both <code><a href="../reference/triangulate.html">triangulate()</a></code> and
<code><a href="../reference/transform_with.html">transform_with()</a></code> return nothing. The output is
<code>NULL</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">del</span> <span class="op">=</span> <span class="fu"><a href="../reference/triangulate.html">triangulate</a></span><span class="op">(</span>filter <span class="op">=</span> <span class="fu"><a href="../reference/filters.html">keep_ground</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">norm</span> <span class="op">=</span> <span class="fu"><a href="../reference/transform_with.html">transform_with</a></span><span class="op">(</span><span class="va">del</span>, <span class="st">"-"</span><span class="op">)</span></span>
<span><span class="va">pipeline</span> <span class="op">=</span> <span class="va">del</span> <span class="op">+</span> <span class="va">norm</span></span>
<span><span class="va">ans</span> <span class="op">=</span> <span class="fu"><a href="../reference/exec.html">exec</a></span><span class="op">(</span><span class="va">pipeline</span>, on <span class="op">=</span> <span class="va">f</span><span class="op">)</span></span>
<span><span class="va">ans</span></span>
<span><span class="co">#&gt; NULL</span></span></code></pre></div>
<blockquote style="background-color: #d6e9f9; border-left: 5px solid #428bca; padding: 10px;font-size: 14px; border-radius: 5px;">
For convenience this pipeline is pre-recorded in the package under the
name <code><a href="../reference/normalize.html">normalize()</a></code>.
</blockquote>
<blockquote style="background-color: #d6e9f9; border-left: 5px solid #428bca; padding: 10px;font-size: 14px; border-radius: 5px;">
<code><a href="../reference/transform_with.html">transform_with()</a></code> can also transform with a raster. This is
not presented in this tutorial.
</blockquote>
<p>To obtain a meaningful output, it is necessary to chain another
stage. Here the point cloud has been modified but then, it is discarded
because we did nothing with it. For instance, we can compute a Canopy
Height Model (CHM) on the normalized point cloud. In the following
pipeline, the first rasterization (<code>chm1</code>) is applied before
normalization, while the second rasterization occurs after
<code><a href="../reference/transform_with.html">transform_with()</a></code>, thus being applied to the transformed
point cloud.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">del</span> <span class="op">=</span> <span class="fu"><a href="../reference/triangulate.html">triangulate</a></span><span class="op">(</span>filter <span class="op">=</span> <span class="fu"><a href="../reference/filters.html">keep_ground</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">norm</span> <span class="op">=</span> <span class="fu"><a href="../reference/transform_with.html">transform_with</a></span><span class="op">(</span><span class="va">del</span>, <span class="st">"-"</span><span class="op">)</span></span>
<span><span class="va">chm1</span> <span class="op">=</span> <span class="fu"><a href="../reference/rasterize.html">rasterize</a></span><span class="op">(</span><span class="fl">2</span>, <span class="st">"max"</span><span class="op">)</span></span>
<span><span class="va">chm2</span> <span class="op">=</span> <span class="fu"><a href="../reference/rasterize.html">rasterize</a></span><span class="op">(</span><span class="fl">2</span>, <span class="st">"max"</span><span class="op">)</span></span>
<span><span class="va">pipeline</span> <span class="op">=</span> <span class="va">chm1</span> <span class="op">+</span> <span class="va">del</span> <span class="op">+</span> <span class="va">norm</span> <span class="op">+</span> <span class="va">chm2</span></span>
<span><span class="va">ans</span> <span class="op">=</span> <span class="fu"><a href="../reference/exec.html">exec</a></span><span class="op">(</span><span class="va">pipeline</span>, on <span class="op">=</span> <span class="va">f</span><span class="op">)</span></span>
<span></span>
<span><span class="va">col</span> <span class="op">=</span> <span class="fu">grDevices</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html" class="external-link">colorRampPalette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"cyan2"</span>, <span class="st">"yellow"</span>, <span class="st">"red"</span><span class="op">)</span><span class="op">)</span><span class="op">(</span><span class="fl">15</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ans</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">ans</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">col</span><span class="op">)</span></span></code></pre></div>
<p><img src="tutorial_files/figure-html/twt2-1.png" width="768"></p>
<p>After performing normalization, users may want to write the
normalized point cloud to disk for later use. In this case, you can
append the <code><a href="../reference/write_las.html">write_las()</a></code> stage to the pipeline.</p>
</div>
<div class="section level2">
<h2 id="write-las">Write LAS<a class="anchor" aria-label="anchor" href="#write-las"></a>
</h2>
<p><code><a href="../reference/write_las.html">write_las()</a></code> can be called at any point in the pipeline.
It writes one file per input file, using the name of the input files
with added prefixes and suffixes. In the following pipeline, we read the
files, write only the ground points to files named after the original
files with the suffix <code>_ground</code>, perform a triangulation on
the entire point cloud, followed by normalization. Finally, we write the
normalized point cloud with the suffix <code>_normalized</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">write1</span> <span class="op">=</span> <span class="fu"><a href="../reference/write_las.html">write_las</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"/*_ground.laz"</span><span class="op">)</span>, filter <span class="op">=</span> <span class="fu"><a href="../reference/filters.html">keep_ground</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">write2</span> <span class="op">=</span> <span class="fu"><a href="../reference/write_las.html">write_las</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"/*_normalized.laz"</span><span class="op">)</span>, <span class="op">)</span></span>
<span><span class="va">del</span> <span class="op">=</span> <span class="fu"><a href="../reference/triangulate.html">triangulate</a></span><span class="op">(</span>filter <span class="op">=</span> <span class="fu"><a href="../reference/filters.html">keep_ground</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">norm</span> <span class="op">=</span> <span class="fu"><a href="../reference/transform_with.html">transform_with</a></span><span class="op">(</span><span class="va">del</span>, <span class="st">"-"</span><span class="op">)</span></span>
<span><span class="va">pipeline</span> <span class="op">=</span>  <span class="va">write1</span> <span class="op">+</span> <span class="va">del</span> <span class="op">+</span> <span class="va">norm</span> <span class="op">+</span> <span class="va">write2</span></span>
<span><span class="va">ans</span> <span class="op">=</span> <span class="fu"><a href="../reference/exec.html">exec</a></span><span class="op">(</span><span class="va">pipeline</span>, on <span class="op">=</span> <span class="va">f</span><span class="op">)</span></span>
<span><span class="va">ans</span></span>
<span><span class="co">#&gt;  - write_las : /tmp/RtmpOjXl02/bcts_1_ground.laz /tmp/RtmpOjXl02/bcts_2_ground.laz </span></span>
<span><span class="co">#&gt;  - write_las : /tmp/RtmpOjXl02/bcts_1_normalized.laz /tmp/RtmpOjXl02/bcts_2_normalized.laz</span></span></code></pre></div>
<p>It is crucial to include a wildcard <code>*</code> in the file path;
otherwise, a single large file will be created. This behavior may be
intentional. Let’s consider creating a file merge pipeline. In the
following example, no wildcard <code>*</code> is used for the names of
the LAS/LAZ files. The input files are read, and points are sequentially
written to the single file <code>dataset_merged.laz</code>, naturally
forming a merge pipeline.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ofile</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"/dataset_merged.laz"</span><span class="op">)</span></span>
<span><span class="va">merge</span> <span class="op">=</span> <span class="fu"><a href="../reference/reader_las.html">reader_las</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/write_las.html">write_las</a></span><span class="op">(</span><span class="va">ofile</span><span class="op">)</span></span>
<span><span class="va">ans</span> <span class="op">=</span> <span class="fu"><a href="../reference/exec.html">exec</a></span><span class="op">(</span><span class="va">merge</span>, on <span class="op">=</span> <span class="va">f</span><span class="op">)</span></span>
<span><span class="va">ans</span></span>
<span><span class="co">#&gt; [1] "/tmp/RtmpOjXl02/dataset_merged.laz"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="local-maximum">Local maximum<a class="anchor" aria-label="anchor" href="#local-maximum"></a>
</h2>
<p>This stage works either on the point cloud or a raster. In the
following pipeline the first stage builds a CHM, the second stage finds
the local maxima in the point cloud and the second stages finds the
local maxima in the chm. <code>lm1</code> and <code>lm2</code> are
expected to produce relatively close results but not strictly
identical.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">chm</span> <span class="op">=</span> <span class="fu"><a href="../reference/rasterize.html">rasterize</a></span><span class="op">(</span><span class="fl">1</span>, <span class="st">"max"</span><span class="op">)</span></span>
<span><span class="va">lm1</span> <span class="op">=</span> <span class="fu"><a href="../reference/local_maximum.html">local_maximum</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">lm2</span> <span class="op">=</span> <span class="fu"><a href="../reference/local_maximum.html">local_maximum_raster</a></span><span class="op">(</span><span class="va">chm</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">pipeline</span> <span class="op">=</span> <span class="va">chm</span> <span class="op">+</span> <span class="va">lm1</span> <span class="op">+</span> <span class="va">lm2</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="tree-segmentation">Tree Segmentation<a class="anchor" aria-label="anchor" href="#tree-segmentation"></a>
</h2>
<p>This section presents a complex pipeline for tree segmentation using
<code><a href="../reference/local_maximum.html">local_maximum_raster()</a></code> to identify tree tops on a CHM. It
uses <code><a href="../reference/region_growing.html">region_growing()</a></code> to segment the trees using the seeds
produced by <code><a href="../reference/local_maximum.html">local_maximum_raster()</a></code>. The Canopy Height Model
(CHM) is triangulation-based using <code>triangulation()</code> and
<code><a href="../reference/rasterize.html">rasterize()</a></code> in the first returns. The CHM is post-processed
with <code><a href="../reference/pit_fill.html">pit_fill()</a></code>, an algorithm designed to enhance the CHM
by filling pits and NAs. The reader may have noticed that the seeds are
produced with the same raster than the one used in
<code><a href="../reference/region_growing.html">region_growing()</a></code>. This is checked internally to ensure the
seeds are matching the raster used for segmenting the trees.</p>
<p>In this tutorial, the pipeline is tested on one file to render the
page faster. However, this pipeline can be applied to any number of
files and will produce a continuous output, managing the buffer between
files. Every intermediate output can be exported, and in this tutorial,
we export everything to display all the outputs.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">del</span> <span class="op">=</span> <span class="fu"><a href="../reference/triangulate.html">triangulate</a></span><span class="op">(</span>filter <span class="op">=</span> <span class="fu"><a href="../reference/filters.html">keep_first</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">chm</span> <span class="op">=</span> <span class="fu"><a href="../reference/rasterize.html">rasterize</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="va">del</span><span class="op">)</span></span>
<span><span class="va">chm2</span> <span class="op">=</span> <span class="fu"><a href="../reference/pit_fill.html">pit_fill</a></span><span class="op">(</span><span class="va">chm</span><span class="op">)</span></span>
<span><span class="va">seed</span> <span class="op">=</span> <span class="fu"><a href="../reference/local_maximum.html">local_maximum_raster</a></span><span class="op">(</span><span class="va">chm2</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">tree</span> <span class="op">=</span> <span class="fu"><a href="../reference/region_growing.html">region_growing</a></span><span class="op">(</span><span class="va">chm2</span>, <span class="va">seed</span><span class="op">)</span></span>
<span><span class="va">pipeline</span> <span class="op">=</span> <span class="va">del</span> <span class="op">+</span> <span class="va">chm</span> <span class="op">+</span> <span class="va">chm2</span> <span class="op">+</span>  <span class="va">seed</span> <span class="op">+</span> <span class="va">tree</span></span>
<span><span class="va">ans</span> <span class="op">=</span> <span class="fu"><a href="../reference/exec.html">exec</a></span><span class="op">(</span><span class="va">pipeline</span>, on <span class="op">=</span> <span class="va">f</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">col</span> <span class="op">=</span> <span class="fu">grDevices</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html" class="external-link">colorRampPalette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"cyan2"</span>, <span class="st">"yellow"</span>, <span class="st">"red"</span><span class="op">)</span><span class="op">)</span><span class="op">(</span><span class="fl">25</span><span class="op">)</span></span>
<span><span class="va">col2</span> <span class="op">=</span> <span class="fu">grDevices</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html" class="external-link">colorRampPalette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"purple"</span>, <span class="st">"blue"</span>, <span class="st">"cyan2"</span>, <span class="st">"yellow"</span>, <span class="st">"red"</span>, <span class="st">"green"</span><span class="op">)</span><span class="op">)</span><span class="op">(</span><span class="fl">50</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ans</span><span class="op">$</span><span class="va">rasterize</span>, col <span class="op">=</span> <span class="va">col</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ans</span><span class="op">$</span><span class="va">pit_fill</span>, col <span class="op">=</span> <span class="va">col</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ans</span><span class="op">$</span><span class="va">region_growing</span>, col <span class="op">=</span> <span class="va">col2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">277</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ans</span><span class="op">$</span><span class="va">local_maximum</span><span class="op">$</span><span class="va">geom</span>, add <span class="op">=</span> <span class="cn">T</span>, pch <span class="op">=</span> <span class="fl">19</span>, cex <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-9-1.png" width="384"><img src="tutorial_files/figure-html/unnamed-chunk-9-2.png" width="384"><img src="tutorial_files/figure-html/unnamed-chunk-9-3.png" width="384"></p>
</div>
<div class="section level2">
<h2 id="callback">Callback<a class="anchor" aria-label="anchor" href="#callback"></a>
</h2>
<p>The <code>callback</code> stage holds significant importance as the
second and last entry point to inject R code into the pipeline,
following <code><a href="../reference/rasterize.html">rasterize()</a></code>. For those familiar with the
<code>lidR</code> package, the initial step often involves reading data
with <code><a href="https://rdrr.io/pkg/lidR/man/readLAS.html" class="external-link">lidR::readLAS()</a></code> to expose the point cloud as a
<code>data.frame</code> object in R. In contrast, <code>lasR</code>
loads the point cloud optimally in C++ without exposing it directly to
R. However, with <code>callback</code>, it becomes possible to expose
the point cloud as a <code>data.frame</code> for executing specific R
functions.</p>
<p>Similar to <code>lidR</code>, the attributes of the point cloud in
<code>lasR</code> are named: <code>X</code>, <code>Y</code>,
<code>Z</code>, <code>Intensity</code>, <code>gpstime</code>,
<code>ReturnNumber</code>, <code>NumberOfreturns</code>,
<code>Classification</code>, <code>UserData</code>,
<code>PointSourceID</code>, <code>R</code>, <code>G</code>,
<code>B</code>, <code>NIR</code>. Notably, for users accustomed to the
<code>lidR</code> package, the scanner angle is consistently named
<code>ScanAngle</code> and is numeric, as opposed to
<code>ScanAngleRank/ScanAngle</code>. Additionally, flags are named
<code>Withheld</code>, <code>Synthetic</code>, and
<code>Keypoint</code>.</p>
<p>Let’s delve into a simple example. For each LAS file, the
<code>callback</code> loads the point cloud as a <code>data.frame</code>
and invokes the <code>meanz()</code> function on the
<code>data.frame</code>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meanz</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">{</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">Z</span><span class="op">)</span><span class="op">)</span> <span class="op">}</span></span>
<span><span class="va">call</span> <span class="op">=</span> <span class="fu"><a href="../reference/callback.html">callback</a></span><span class="op">(</span><span class="va">meanz</span>, expose <span class="op">=</span> <span class="st">"xyz"</span><span class="op">)</span></span>
<span><span class="va">ans</span> <span class="op">=</span> <span class="fu"><a href="../reference/exec.html">exec</a></span><span class="op">(</span><span class="va">call</span>, on <span class="op">=</span> <span class="va">f</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ans</span><span class="op">)</span></span>
<span><span class="co">#&gt;  - 809.0835 </span></span>
<span><span class="co">#&gt;  - 13.27202</span></span></code></pre></div>
<p>Here the output is a <code>list</code> with two elements because we
processed two files (<code>f</code> is not displayed in this document).
The average Z elevation are respectively 809.08 and 13.27 in each
file.</p>
<blockquote style="background-color: #fff3cd; border-left: 5px solid #ffc107; padding: 10px; font-size: 14px; border-radius: 5px;">
Be mindful that, for a given LAS/LAZ file, the point cloud may contain
more points than the original file <strong>if the file is loaded with a
buffer</strong>. Further clarification on this matter will be provided
later.
</blockquote>
<p>The <code>callback</code> function is versatile and can also be
employed to edit the point cloud. When the user-defined function returns
a <code>data.frame</code> with the same number of rows as the original
one, the function edits the underlying C++ dataset. This enables users
to perform tasks such as assigning a class to a specific point. While
physically removing points is not possible, users can flag points as
<code>Withheld</code>. In such cases, these points will not be processed
in subsequent stages, they are discarded.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">edit_points</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">data</span><span class="op">$</span><span class="va">Classification</span><span class="op">[</span><span class="fl">5</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2L</span>,<span class="fl">2L</span>,<span class="fl">2L</span><span class="op">)</span></span>
<span>  <span class="va">data</span><span class="op">$</span><span class="va">Withheld</span> <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="va">data</span><span class="op">$</span><span class="va">Withheld</span><span class="op">[</span><span class="fl">12</span><span class="op">]</span> <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">call</span> <span class="op">=</span> <span class="fu"><a href="../reference/callback.html">callback</a></span><span class="op">(</span><span class="va">edit_points</span>, expose <span class="op">=</span> <span class="st">"xyzc"</span><span class="op">)</span></span>
<span><span class="va">ans</span> <span class="op">=</span> <span class="fu"><a href="../reference/exec.html">exec</a></span><span class="op">(</span><span class="va">call</span>, on <span class="op">=</span> <span class="va">f</span><span class="op">)</span></span>
<span><span class="va">ans</span></span>
<span><span class="co">#&gt; NULL</span></span></code></pre></div>
<p>As observed, here, this time <code>callback</code> does not
explicitly return anything; however, it edited the point cloud
internally. To generate an output, users must use another stage such as
<code><a href="../reference/write_las.html">write_las()</a></code>. It’s important to note that
<code><a href="../reference/write_las.html">write_las()</a></code> will <strong>NOT</strong> write the point
number 12 which is flagged <code>withheld</code>. Neither any subsequent
stage will process it. The point is still in memory but is
discarded.</p>
<blockquote style="background-color: #f8d7da; border-left: 5px solid #dc3545; padding: 10px; font-size: 14px; border-radius: 5px;">
For memory and efficiency reasons, it is not possible to physically
remove a point from the underlying memory in <code>lasR</code>. Instead,
the points flagged as <code>withheld</code> will <strong>never be
processed</strong>. One consequence of this, is that points flagged as
withheld in a LAS/LAZ file <strong>will not</strong> be processed in
<code>lasR</code>. This aligns with the intended purpose of the flag
according to the LAS specification but may differ from the default
behavior of many software on the market including <code>lidR</code>.
</blockquote>
<p>Now, let’s explore the capabilities of <code>callback</code> further.
First, let’s create a lidR-like <code>read_las()</code> function to
expose the point cloud to R. In the following example, the user-defined
function is employed to return the <code>data.frame</code> as is. When
the user’s function returns a <code>data.frame</code> with the same
number of points as the original dataset, this updates the points at the
C++ level. Here, we use <code>no_las_update = TRUE</code> to explicitly
return the result.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">read_las</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">f</span>, <span class="va">select</span> <span class="op">=</span> <span class="st">"xyzi"</span>, <span class="va">filter</span> <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">load</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">}</span></span>
<span>  <span class="va">read</span> <span class="op">=</span> <span class="fu"><a href="../reference/reader_las.html">reader_las</a></span><span class="op">(</span>filter <span class="op">=</span> <span class="va">filter</span><span class="op">)</span></span>
<span>  <span class="va">call</span> <span class="op">=</span> <span class="fu"><a href="../reference/callback.html">callback</a></span><span class="op">(</span><span class="va">load</span>, expose <span class="op">=</span> <span class="va">select</span>, no_las_update <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span> <span class="op">(</span><span class="fu"><a href="../reference/exec.html">exec</a></span><span class="op">(</span><span class="va">read</span><span class="op">+</span><span class="va">call</span>, on <span class="op">=</span> <span class="va">f</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"Topography.las"</span>, package<span class="op">=</span><span class="st">"lasR"</span><span class="op">)</span></span>
<span><span class="va">las</span> <span class="op">=</span> <span class="fu">read_las</span><span class="op">(</span><span class="va">f</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">las</span><span class="op">)</span></span>
<span><span class="co">#&gt;          X       Y        Z Intensity</span></span>
<span><span class="co">#&gt; 1 273357.1 5274360 806.5340      1340</span></span>
<span><span class="co">#&gt; 2 273357.2 5274359 806.5635       728</span></span>
<span><span class="co">#&gt; 3 273357.2 5274358 806.0248      1369</span></span>
<span><span class="co">#&gt; 4 273357.2 5274510 809.6303       589</span></span>
<span><span class="co">#&gt; 5 273357.2 5274509 809.3880      1302</span></span>
<span><span class="co">#&gt; 6 273357.2 5274508 809.4847       123</span></span></code></pre></div>
<p>Ground points can also be classified using an R function, such as the
one provided by the <code>RCSF</code> package:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">csf</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">id</span> <span class="op">=</span> <span class="fu">RCSF</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RCSF/man/CSF.html" class="external-link">CSF</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span>  <span class="va">class</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">class</span><span class="op">[</span><span class="va">id</span><span class="op">]</span> <span class="op">=</span> <span class="fl">2L</span></span>
<span>  <span class="va">data</span><span class="op">$</span><span class="va">Classification</span> <span class="op">&lt;-</span> <span class="va">class</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">read</span> <span class="op">=</span> <span class="fu"><a href="../reference/reader_las.html">reader_las</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">classify</span> <span class="op">=</span> <span class="fu"><a href="../reference/callback.html">callback</a></span><span class="op">(</span><span class="va">csf</span>, expose <span class="op">=</span> <span class="st">"xyz"</span><span class="op">)</span></span>
<span><span class="va">write</span> <span class="op">=</span> <span class="fu"><a href="../reference/write_las.html">write_las</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">pipeline</span> <span class="op">=</span> <span class="va">read</span> <span class="op">+</span> <span class="va">classify</span> <span class="op">+</span> <span class="va">write</span></span>
<span><span class="fu"><a href="../reference/exec.html">exec</a></span><span class="op">(</span><span class="va">pipeline</span>, on <span class="op">=</span> <span class="va">f</span><span class="op">)</span></span></code></pre></div>
<blockquote style="background-color: #fff3cd; border-left: 5px solid #ffc107; padding: 10px; font-size: 14px; border-radius: 5px;">
<code><a href="../reference/callback.html">callback()</a></code> exposes the point cloud as a
<code>data.frame</code>. This is the only way to expose the point clouds
to users in a manageable way. One of the reasons why <code>lasR</code>
is more memory-efficient and faster than <code>lidR</code> is that it
<strong>does not</strong> expose the point cloud as a
<code>data.frame</code>. Thus, the pipelines using
<code><a href="../reference/callback.html">callback()</a></code> are not significantly different from
<code>lidR</code>. The advantage of using <code>lasR</code> here is the
ability to pipe different stages.
</blockquote>
</div>
<div class="section level2">
<h2 id="buffer">Buffer<a class="anchor" aria-label="anchor" href="#buffer"></a>
</h2>
<p>Point clouds are typically stored in multiple contiguous files. To
avoid edge artifacts, each file must be loaded with extra points coming
from neighboring files. Everything is handled automatically, except for
the <code><a href="../reference/callback.html">callback()</a></code> stage. In <code><a href="../reference/callback.html">callback()</a></code>, the point
cloud is exposed as a <code>data.frame</code> with the buffer, providing
the user-defined function with some spatial context. If
<code>callback</code> is used to edit the points, everything is handled
internally. However, if an R object is returned, it is the
responsibility of the user to handle the buffer.</p>
<p>For example, in the following pipeline, we are processing two files,
and <code><a href="../reference/callback.html">callback()</a></code> is used to count the number of points. The
presence of <code><a href="../reference/triangulate.html">triangulate()</a></code> implies that each file will be
loaded with a buffer to make a valid triangulation. Consequently,
counting the points in <code><a href="../reference/callback.html">callback()</a></code> returns more points than
<code><a href="../reference/summarise.html">summarise()</a></code> because <code><a href="../reference/summarise.html">summarise()</a></code> is an internal
function that knows how to deal with the buffer.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">count</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">X</span><span class="op">)</span> <span class="op">}</span></span>
<span><span class="va">del</span> <span class="op">=</span> <span class="fu"><a href="../reference/triangulate.html">triangulate</a></span><span class="op">(</span>filter <span class="op">=</span> <span class="fu"><a href="../reference/filters.html">keep_ground</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">npts</span> <span class="op">=</span> <span class="fu"><a href="../reference/callback.html">callback</a></span><span class="op">(</span><span class="va">count</span>, expose <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span></span>
<span><span class="va">sum</span> <span class="op">=</span> <span class="fu"><a href="../reference/summarise.html">summarise</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">ans</span> <span class="op">=</span> <span class="fu"><a href="../reference/exec.html">exec</a></span><span class="op">(</span><span class="va">del</span> <span class="op">+</span> <span class="va">npts</span> <span class="op">+</span> <span class="va">sum</span>, on <span class="op">=</span> <span class="va">f</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ans</span><span class="op">$</span><span class="va">callback</span><span class="op">)</span></span>
<span><span class="co">#&gt;  - 682031 </span></span>
<span><span class="co">#&gt;  - 931581</span></span>
<span><span class="va">ans</span><span class="op">$</span><span class="va">callback</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">+</span> <span class="va">ans</span><span class="op">$</span><span class="va">callback</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 1613612</span></span>
<span><span class="va">ans</span><span class="op">$</span><span class="va">summary</span><span class="op">$</span><span class="va">npoints</span></span>
<span><span class="co">#&gt; [1] 1355607</span></span></code></pre></div>
<p>We can compare this with the pipeline without
<code><a href="../reference/triangulate.html">triangulate()</a></code>. In this case, there is no reason to use a
buffer, and the files are not buffered. The counts are equal.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ans</span> <span class="op">=</span> <span class="fu"><a href="../reference/exec.html">exec</a></span><span class="op">(</span><span class="va">npts</span> <span class="op">+</span> <span class="va">sum</span>, on <span class="op">=</span> <span class="va">f</span><span class="op">)</span></span>
<span><span class="va">ans</span><span class="op">$</span><span class="va">callback</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">+</span> <span class="va">ans</span><span class="op">$</span><span class="va">callback</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 1355607</span></span>
<span><span class="va">ans</span><span class="op">$</span><span class="va">summary</span><span class="op">$</span><span class="va">npoints</span></span>
<span><span class="co">#&gt; [1] 1355607</span></span></code></pre></div>
<p>To handle the buffer, the user can read the attribute
<code>bbox</code> of the <code>data.frame</code>. It contains the
bounding box of the point cloud without the buffer or use the column
<code>Buffer</code> that contains <code>TRUE</code> or
<code>FALSE</code> for each point. If <code>TRUE</code>, the point is in
the buffer. The buffer is exposed only if the user includes the letter
<code>'b'</code>.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">count_buffer_aware</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">bbox</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">data</span>, <span class="st">"bbox"</span><span class="op">)</span></span>
<span>  <span class="va">npoints</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="va">data</span><span class="op">$</span><span class="va">Buffer</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="va">bbox</span>, npoints <span class="op">=</span> <span class="va">npoints</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">del</span> <span class="op">=</span> <span class="fu"><a href="../reference/triangulate.html">triangulate</a></span><span class="op">(</span>filter <span class="op">=</span> <span class="fu"><a href="../reference/filters.html">keep_ground</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">npts</span> <span class="op">=</span> <span class="fu"><a href="../reference/callback.html">callback</a></span><span class="op">(</span><span class="va">count_buffer_aware</span>, expose <span class="op">=</span> <span class="st">"b"</span><span class="op">)</span> <span class="co"># b for buffer</span></span>
<span><span class="va">sum</span> <span class="op">=</span> <span class="fu"><a href="../reference/summarise.html">summarise</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">ans</span> <span class="op">=</span> <span class="fu"><a href="../reference/exec.html">exec</a></span><span class="op">(</span><span class="va">del</span> <span class="op">+</span> <span class="va">npts</span> <span class="op">+</span> <span class="va">sum</span>, on <span class="op">=</span> <span class="va">f</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ans</span><span class="op">$</span><span class="va">callback</span><span class="op">)</span></span>
<span><span class="co">#&gt;  - List:</span></span>
<span><span class="co">#&gt;    - bbox : 885022.4 629157.2 885210.2 629400 </span></span>
<span><span class="co">#&gt;    - npoints : 531662 </span></span>
<span><span class="co">#&gt;  - List:</span></span>
<span><span class="co">#&gt;    - bbox : 885024.1 629400 885217.1 629700 </span></span>
<span><span class="co">#&gt;    - npoints : 823945</span></span>
<span><span class="va">ans</span><span class="op">$</span><span class="va">callback</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">npoints</span><span class="op">+</span> <span class="va">ans</span><span class="op">$</span><span class="va">callback</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">npoints</span></span>
<span><span class="co">#&gt; [1] 1355607</span></span>
<span><span class="va">ans</span><span class="op">$</span><span class="va">summary</span><span class="op">$</span><span class="va">npoints</span></span>
<span><span class="co">#&gt; [1] 1355607</span></span></code></pre></div>
<p>In conclusion, in the hypothesis that the user-defined function
returns something complex, there are two ways to handle the buffer:
either using the bounding box or using the <code>Buffer</code> flag. A
third option is to use <code>drop_buffer</code>. In this case users
ensure to receive a <code>data.frame</code> that does not include points
from the buffer.</p>
</div>
<div class="section level2">
<h2 id="hulls">Hulls<a class="anchor" aria-label="anchor" href="#hulls"></a>
</h2>
<p>A Delaunay triangulation defines a convex polygon, which represents
the convex hull of the points. However, in dense point clouds, removing
triangles with large edges due to the absence of points results in a
more complex structure.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">del</span> <span class="op">=</span> <span class="fu"><a href="../reference/triangulate.html">triangulate</a></span><span class="op">(</span><span class="fl">15</span>, filter <span class="op">=</span> <span class="fu"><a href="../reference/filters.html">keep_ground</a></span><span class="op">(</span><span class="op">)</span>, ofile <span class="op">=</span> <span class="fu"><a href="../reference/temporary_files.html">tempgpkg</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ans</span> <span class="op">=</span> <span class="fu"><a href="../reference/exec.html">exec</a></span><span class="op">(</span><span class="va">del</span>, on <span class="op">=</span> <span class="va">f</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ans</span>, axes <span class="op">=</span> <span class="cn">T</span>, lwd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="tutorial_files/figure-html/hulls-1.png" width="480"></p>
<p>The <code><a href="../reference/hulls.html">hulls()</a></code> algorithm computes the contour of the mesh,
producing a concave hull with holes:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">del</span> <span class="op">=</span> <span class="fu"><a href="../reference/triangulate.html">triangulate</a></span><span class="op">(</span><span class="fl">15</span>, filter <span class="op">=</span> <span class="fu"><a href="../reference/filters.html">keep_ground</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">bound</span> <span class="op">=</span> <span class="fu"><a href="../reference/hulls.html">hulls</a></span><span class="op">(</span><span class="va">del</span><span class="op">)</span></span>
<span><span class="va">ans</span> <span class="op">=</span> <span class="fu"><a href="../reference/exec.html">exec</a></span><span class="op">(</span><span class="va">del</span><span class="op">+</span><span class="va">bound</span>, on <span class="op">=</span> <span class="va">f</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ans</span>, axes <span class="op">=</span> <span class="cn">T</span>, lwd <span class="op">=</span> <span class="fl">0.5</span>, col <span class="op">=</span> <span class="st">"gray"</span><span class="op">)</span></span></code></pre></div>
<p><img src="tutorial_files/figure-html/hulls2-1.png" width="480"></p>
<p>However <code><a href="../reference/hulls.html">hulls()</a></code> is more likely to be used without a
triangulation. In this case it returns the bounding box of each LAS/LAZ
file read from the header. And if it is used with
<code>triangulate(0)</code> it returns the convex hull but this is a
very inefficient way to get the convex hull.</p>
</div>
<div class="section level2">
<h2 id="sampling-voxel">Sampling Voxel<a class="anchor" aria-label="anchor" href="#sampling-voxel"></a>
</h2>
<p>The <code><a href="../reference/sampling.html">sampling_voxel()</a></code> and <code><a href="../reference/summarise.html">summarise()</a></code>
functions operate similarly to other algorithms, and their output
depends on their position in the pipeline:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pipeline</span> <span class="op">=</span> <span class="fu"><a href="../reference/summarise.html">summarise</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/sampling.html">sampling_voxel</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/summarise.html">summarise</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">ans</span> <span class="op">=</span> <span class="fu"><a href="../reference/exec.html">exec</a></span><span class="op">(</span><span class="va">pipeline</span>, on <span class="op">=</span> <span class="va">f</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ans</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;  - npoints : 73403 </span></span>
<span><span class="co">#&gt;  - nsingle : 31294 </span></span>
<span><span class="co">#&gt;  - nwithheld : 0 </span></span>
<span><span class="co">#&gt;  - nsynthetic : 0 </span></span>
<span><span class="co">#&gt;  - npoints_per_return : 53538 15828 3569 451 16 1 </span></span>
<span><span class="co">#&gt;  - npoints_per_class : 61347 8159 3897</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ans</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;  - npoints : 12745 </span></span>
<span><span class="co">#&gt;  - nsingle : 5082 </span></span>
<span><span class="co">#&gt;  - nwithheld : 0 </span></span>
<span><span class="co">#&gt;  - nsynthetic : 0 </span></span>
<span><span class="co">#&gt;  - npoints_per_return : 9484 2536 630 93 2 </span></span>
<span><span class="co">#&gt;  - npoints_per_class : 10830 1541 374</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="readers">Readers<a class="anchor" aria-label="anchor" href="#readers"></a>
</h2>
<p><code><a href="../reference/reader_las.html">reader_las()</a></code> MUST be the first stage of each pipeline
even if it can conveniently be omitted in its simplest form. However
there are several readers hidden behind <code><a href="../reference/reader_las.html">reader_las()</a></code>:</p>
<ul>
<li>
<code><a href="../reference/reader_las.html">reader_las_coverage()</a></code>: will read of the files and
process the entire point cloud. This is the default behavior of
<code><a href="../reference/reader_las.html">reader_las()</a></code>.</li>
<li>
<code><a href="../reference/reader_las.html">reader_las_rectangles()</a></code>: will read only some
rectangular regions of interest of the coverage and process then
sequentially.</li>
<li>
<code><a href="../reference/reader_las.html">reader_las_circles()</a></code>: will read only some circular
regions of interest of the coverage and process then sequentially.</li>
</ul>
<p>The following pipeline triangulates the ground points, normalizes the
point cloud, and computes some metric of interest <strong>for each file
of the entire coverage</strong>. Each file is loaded with a buffer so
that triangulation is performed without edge artifacts. Notice the use
of <code>drop_buffer = TRUE</code> to expose the <code>data.frame</code>
without the buffer used to perform the triangulation and
normalization.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_metric_fun</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">Z</span><span class="op">)</span> <span class="op">}</span></span>
<span><span class="va">tri</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/triangulate.html">triangulate</a></span><span class="op">(</span>filter <span class="op">=</span> <span class="fu"><a href="../reference/filters.html">keep_ground</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">trans</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/transform_with.html">transform_with</a></span><span class="op">(</span><span class="va">tri</span><span class="op">)</span></span>
<span><span class="va">norm</span> <span class="op">&lt;-</span> <span class="va">tri</span> <span class="op">+</span> <span class="va">trans</span></span>
<span><span class="va">metric</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/callback.html">callback</a></span><span class="op">(</span><span class="va">my_metric_fun</span>, expose <span class="op">=</span> <span class="st">"z"</span>, drop_buffer <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">pipeline</span> <span class="op">=</span> <span class="va">norm</span> <span class="op">+</span> <span class="va">metric</span></span></code></pre></div>
<p>The following pipeline, on the contrary, works exactly the same but
operates only on circular plots.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pipeline</span> <span class="op">=</span> <span class="fu"><a href="../reference/reader_las.html">reader_las_circles</a></span><span class="op">(</span><span class="va">xcenter</span>, <span class="va">ycenter</span>, <span class="fl">11.28</span><span class="op">)</span> <span class="op">+</span> <span class="va">pipeline</span></span></code></pre></div>
<p>These readers allow building a ground inventory pipeline, or a plot
extraction for examples</p>
</div>
<div class="section level2">
<h2 id="plot-inventory">Plot inventory<a class="anchor" aria-label="anchor" href="#plot-inventory"></a>
</h2>
<p>This pipeline extracts a plot inventory using a shapefile from a
non-normalized point cloud, normalizes each plot, computes metrics for
each plot, and writes each normalized and non-normalized plot in
separate files. Each circular plot is <strong>loaded with a
buffer</strong> to perform a correct triangulation. The plots are
exposed to R without the buffer using
<code>drop_buffer = TRUE</code>.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ofiles_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"/plot_*.las"</span><span class="op">)</span></span>
<span><span class="va">ofiles_plot_norm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"/plot_*_norm.las"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">my_metric_fun</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">Z</span><span class="op">)</span> <span class="op">}</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="va">inventory</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="st">"shapefile.shp"</span><span class="op">)</span></span>
<span><span class="va">coordinates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">inventory</span><span class="op">)</span></span>
<span><span class="va">xcenter</span> <span class="op">&lt;-</span> <span class="va">coordinates</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">ycenter</span> <span class="op">&lt;-</span> <span class="va">coordinates</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span></span>
<span><span class="va">read</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reader_las.html">reader_las</a></span><span class="op">(</span>xc <span class="op">=</span> <span class="va">xcenter</span>, yc <span class="op">=</span> <span class="va">ycenter</span>, r <span class="op">=</span> <span class="fl">11.28</span><span class="op">)</span> </span>
<span><span class="va">tri</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/triangulate.html">triangulate</a></span><span class="op">(</span>filter <span class="op">=</span> <span class="fu"><a href="../reference/filters.html">keep_ground</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">trans</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/transform_with.html">transform_with</a></span><span class="op">(</span><span class="va">tri</span><span class="op">)</span></span>
<span><span class="va">norm</span> <span class="op">&lt;-</span> <span class="va">tri</span> <span class="op">+</span> <span class="va">trans</span></span>
<span><span class="va">metric</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/callback.html">callback</a></span><span class="op">(</span><span class="va">my_metric_fun</span>, expose <span class="op">=</span> <span class="st">"z"</span>, drop_buffer <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">write1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/write_las.html">write_las</a></span><span class="op">(</span><span class="va">ofiles_plot</span><span class="op">)</span></span>
<span><span class="va">write2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/write_las.html">write_las</a></span><span class="op">(</span><span class="va">ofiles_plot_norm</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pipeline</span> <span class="op">=</span> <span class="va">read</span> <span class="op">+</span> <span class="va">trans</span> <span class="op">+</span> <span class="va">write1</span> <span class="op">+</span> <span class="va">norm</span> <span class="op">+</span> <span class="va">write2</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="wildcard-usage">Wildcard Usage<a class="anchor" aria-label="anchor" href="#wildcard-usage"></a>
</h2>
<p>Usually, <code><a href="../reference/write_las.html">write_las()</a></code> is used with a wildcard in the
<code>ofile</code> argument (see above) to write one file per processed
file. Otherwise, everything is written into a single massive LAS file
(which might be the desired behavior). On the contrary,
<code><a href="../reference/rasterize.html">rasterize()</a></code> is used without a wildcard to write everything
into a single raster file, but it also accepts a wildcard to write the
results in multiple files, which is very useful with
<code><a href="../reference/reader_las.html">reader_las_circles()</a></code> to avoid having one massive raster
mostly empty. Compare this pipeline with and without the wildcard.</p>
<p>Without a wildcard, the output is a single raster that covers the
entire point cloud with two patches of populated pixels.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ofile</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"/chm.tif"</span><span class="op">)</span>   <span class="co"># no wildcard</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">885100</span>, <span class="fl">885100</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">629200</span>, <span class="fl">629600</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pipeline</span> <span class="op">=</span> <span class="fu"><a href="../reference/reader_las.html">reader_las</a></span><span class="op">(</span>xc <span class="op">=</span> <span class="va">x</span>, yc <span class="op">=</span> <span class="va">y</span>, r <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/rasterize.html">rasterize</a></span><span class="op">(</span><span class="fl">2</span>, <span class="st">"max"</span>, ofile <span class="op">=</span> <span class="va">ofile</span><span class="op">)</span></span>
<span><span class="va">r0</span> <span class="op">=</span> <span class="fu"><a href="../reference/exec.html">exec</a></span><span class="op">(</span><span class="va">pipeline</span>, on <span class="op">=</span> <span class="va">f</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">r0</span>, col <span class="op">=</span> <span class="va">col</span><span class="op">)</span> <span class="co"># covers the entire collection of files</span></span></code></pre></div>
<p><img src="tutorial_files/figure-html/nowildcard-1.png" width="768"></p>
<p>With a wildcard, the output contains two rasters that cover regions
of interest.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ofile</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"/chm_*.tif"</span><span class="op">)</span> <span class="co"># wildcard</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">885100</span>, <span class="fl">885100</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">629200</span>, <span class="fl">629600</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pipeline</span> <span class="op">=</span> <span class="fu"><a href="../reference/reader_las.html">reader_las</a></span><span class="op">(</span>xc <span class="op">=</span> <span class="va">x</span>, yc <span class="op">=</span> <span class="va">y</span>, r <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/rasterize.html">rasterize</a></span><span class="op">(</span><span class="fl">2</span>, <span class="st">"max"</span>, ofile <span class="op">=</span> <span class="va">ofile</span><span class="op">)</span></span>
<span><span class="va">ans</span> <span class="op">=</span> <span class="fu"><a href="../reference/exec.html">exec</a></span><span class="op">(</span><span class="va">pipeline</span>, on <span class="op">=</span> <span class="va">f</span><span class="op">)</span></span>
<span></span>
<span><span class="va">r1</span> <span class="op">=</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">ans</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">r2</span> <span class="op">=</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">ans</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">r1</span>, col <span class="op">=</span> <span class="va">col</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">r2</span>, col <span class="op">=</span> <span class="va">col</span><span class="op">)</span></span></code></pre></div>
<p><img src="tutorial_files/figure-html/wildcard-1.png" width="50%"><img src="tutorial_files/figure-html/wildcard-2.png" width="50%"></p>
</div>
<div class="section level2">
<h2 id="compatibility-with-lidr">Compatibility with lidR<a class="anchor" aria-label="anchor" href="#compatibility-with-lidr"></a>
</h2>
<p>While <code>lasR</code> does not depends on <code>lidR</code> it has
some compatibility with it. Instead of providing paths to files or
folder it is possible to pass a <code>LAScatalog</code> or a
<code>LAS</code> object to the readers.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-lidar/lasR" class="external-link">lasR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-lidar/lidR" class="external-link">lidR</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">pipeline</span> <span class="op">=</span> <span class="fu"><a href="../reference/normalize.html">normalize</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/write_las.html">write_las</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ctg</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lidR/man/readLAScatalog.html" class="external-link">readLAScatalog</a></span><span class="op">(</span><span class="va">folder</span><span class="op">)</span></span>
<span><span class="va">ans</span> <span class="op">=</span> <span class="fu"><a href="../reference/exec.html">exec</a></span><span class="op">(</span><span class="va">pipeline</span>, on <span class="op">=</span> <span class="va">ctg</span><span class="op">)</span></span>
<span></span>
<span><span class="va">las</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lidR/man/readLAS.html" class="external-link">readLAS</a></span><span class="op">(</span><span class="va">file</span><span class="op">)</span></span>
<span><span class="va">ans</span> <span class="op">=</span> <span class="fu"><a href="../reference/exec.html">exec</a></span><span class="op">(</span><span class="va">pipeline</span>, on <span class="op">=</span> <span class="va">las</span><span class="op">)</span></span></code></pre></div>
<p>In the case of a <code>LAScatalog</code>, <code><a href="../reference/exec.html">exec()</a></code>
respects the processing options of the <code>LAScatalog</code> including
the chunk size, chunk buffer, progress bar display and partial
processing. In the general case, the same options can be supplied as
arguments of the <code><a href="../reference/exec.html">exec()</a></code> functions.</p>
</div>
<div class="section level2">
<h2 id="parallel-processing">Parallel processing<a class="anchor" aria-label="anchor" href="#parallel-processing"></a>
</h2>
<p>The topic is covered in a <a href="multithreading.html">dedicated
article</a></p>
</div>
<div class="section level2">
<h2 id="other-stages">Other stages<a class="anchor" aria-label="anchor" href="#other-stages"></a>
</h2>
<p><code>lasR</code> has several other stages not mentioned in this
tutorial. Among others:</p>
<ul>
<li><code><a href="../reference/add_extrabytes.html">add_extrabytes()</a></code></li>
<li><code><a href="../reference/add_rgb.html">add_rgb()</a></code></li>
<li><code>classify_isolated_voxel()</code></li>
<li><code><a href="../reference/delete_points.html">delete_points()</a></code></li>
<li><code><a href="../reference/load_raster.html">load_raster()</a></code></li>
<li><code><a href="../reference/pit_fill.html">pit_fill()</a></code></li>
<li><code><a href="../reference/write_vpc.html">write_vpc()</a></code></li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Jean-Romain Roussel.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>

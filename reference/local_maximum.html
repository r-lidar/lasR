<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Local Maximum — local_maximum • lasR</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Local Maximum — local_maximum"><meta name="description" content="The Local Maximum stage identifies points that are locally maximum. The window size is
fixed and circular. This stage does not modify the point cloud. It produces a derived product
in vector format. The function local_maximum_raster applies on a raster instead of the point cloud"><meta property="og:description" content="The Local Maximum stage identifies points that are locally maximum. The window size is
fixed and circular. This stage does not modify the point cloud. It produces a derived product
in vector format. The function local_maximum_raster applies on a raster instead of the point cloud"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">lasR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.17.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Presentation</h6></li>
    <li><a class="dropdown-item" href="../articles/why.html">Why lasR?</a></li>
    <li><a class="dropdown-item" href="../articles/benchmarks.html">Benchmarks of lasR vs. lidR</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Tutorials</h6></li>
    <li><a class="dropdown-item" href="../articles/tutorial.html">Tutorial</a></li>
    <li><a class="dropdown-item" href="../articles/multithreading.html">Parallel processing</a></li>
    <li><a class="dropdown-item" href="../articles/r-stages.html">R stages</a></li>
    <li><a class="dropdown-item" href="../articles/baba.html">Buffered Area Based Approach</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-lidar/lasR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Local Maximum</h1>
      <small class="dont-index">Source: <a href="https://github.com/r-lidar/lasR/blob/main/R/stages.R" class="external-link"><code>R/stages.R</code></a></small>
      <div class="d-none name"><code>local_maximum.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The Local Maximum stage identifies points that are locally maximum. The window size is
fixed and circular. This stage does not modify the point cloud. It produces a derived product
in vector format. The function <code>local_maximum_raster</code> applies on a raster instead of the point cloud</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">local_maximum</span><span class="op">(</span></span>
<span>  <span class="va">ws</span>,</span>
<span>  min_height <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  filter <span class="op">=</span> <span class="st">""</span>,</span>
<span>  ofile <span class="op">=</span> <span class="fu"><a href="temporary_files.html">tempgpkg</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  use_attribute <span class="op">=</span> <span class="st">"Z"</span>,</span>
<span>  record_attributes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  store_in_attribute <span class="op">=</span> <span class="st">""</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">local_maximum_raster</span><span class="op">(</span></span>
<span>  <span class="va">raster</span>,</span>
<span>  <span class="va">ws</span>,</span>
<span>  min_height <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  filter <span class="op">=</span> <span class="st">""</span>,</span>
<span>  ofile <span class="op">=</span> <span class="fu"><a href="temporary_files.html">tempgpkg</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-ws">ws<a class="anchor" aria-label="anchor" href="#arg-ws"></a></dt>
<dd><p>numeric. Diameter of the moving window used to detect the local maxima in the units of
the input data (usually meters).</p></dd>


<dt id="arg-min-height">min_height<a class="anchor" aria-label="anchor" href="#arg-min-height"></a></dt>
<dd><p>numeric. Minimum height of a local maximum. Threshold below which a point cannot be a
local maximum. Default is 2.</p></dd>


<dt id="arg-filter">filter<a class="anchor" aria-label="anchor" href="#arg-filter"></a></dt>
<dd><p>the 'filter' argument allows filtering of the point-cloud to work with points of
interest. For a given stage when a filter is applied, only the points that meet the criteria are processed.
The most common strings are <code>Classification == 2"</code>, <code>"Z &gt; 2"</code>, <code>"Intensity &lt; 100"</code>. For more details see
<a href="filters.html">filters</a>.</p></dd>


<dt id="arg-ofile">ofile<a class="anchor" aria-label="anchor" href="#arg-ofile"></a></dt>
<dd><p>character. Full outputs are always stored on disk. If <code>ofile = ""</code>
then the stage will not store the result on disk and will return nothing. It will however
hold partial output results temporarily in memory. This is useful for stage that are only
intermediate stage.</p></dd>


<dt id="arg-use-attribute">use_attribute<a class="anchor" aria-label="anchor" href="#arg-use-attribute"></a></dt>
<dd><p>character. Specifies the attribute to use for the operation, with "Z" (the coordinate) as the default.
Alternatively, this can be the name of any other attribute, such as "Intensity", "gpstime", "ReturnNumber", or "HAG", if it exists.
Note: The function does not fail if the specified attribute does not exist in the point cloud.
For example, if "Intensity" is requested but not present, or "HAG" is specified but unavailable,
the internal engine will return 0 for the missing attribute.</p></dd>


<dt id="arg-record-attributes">record_attributes<a class="anchor" aria-label="anchor" href="#arg-record-attributes"></a></dt>
<dd><p>The coordinates XYZ of points corresponding to the local maxima are recorded.
It is also possible to record the attributes of theses points such as the intensity, return number, scan
angle and so on.</p></dd>


<dt id="arg-store-in-attribute">store_in_attribute<a class="anchor" aria-label="anchor" href="#arg-store-in-attribute"></a></dt>
<dd><p>In addition to producing a geospatial file with the local maxima,
the points can also be flagged: 0 if the point is not a local maximum, and 1 if the
point is a local maximum. If the attribute does not exist, it must first be created
with <a href="add_attribute.html">add_extrabytes</a> (see examples).</p></dd>


<dt id="arg-raster">raster<a class="anchor" aria-label="anchor" href="#arg-raster"></a></dt>
<dd><p>LASRalgorithm. A stage that produces a raster.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>This stage produces a vector. The path provided to `ofile` is expected to be `.gpkg` or
any other format supported by GDAL. Vector stages may produce geometries with Z coordinates.
Thus, it is discouraged to store them in formats with no 3D support, such as shapefiles.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"MixedConifer.las"</span>, package <span class="op">=</span> <span class="st">"lasR"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">read</span> <span class="op">&lt;-</span> <span class="fu"><a href="reader.html">reader</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">lmf</span> <span class="op">&lt;-</span> <span class="fu">local_maximum</span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ans</span> <span class="op">&lt;-</span> <span class="fu"><a href="exec.html">exec</a></span><span class="op">(</span><span class="va">read</span> <span class="op">+</span> <span class="va">lmf</span>, on <span class="op">=</span> <span class="va">f</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ans</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Simple feature collection with 177 features and 0 fields</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Geometry type: POINT</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dimension:     XYZ</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bounding box:  xmin: 481260 ymin: 3812921 xmax: 481349.8 ymax: 3813011</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> z_range:       zmin: 2.42 zmax: 32.07</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Projected CRS: NAD83 / UTM zone 12N</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> First 10 features:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                              geom</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  POINT Z (481309.9 3812944 2...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2   POINT Z (481294.7 3813011 16)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  POINT Z (481281.9 3813003 2...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  POINT Z (481278.4 3813002 2...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  POINT Z (481307.2 3813000 2...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  POINT Z (481265.3 3812996 1...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7  POINT Z (481261.8 3812999 1...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8  POINT Z (481260.7 3812939 2...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9  POINT Z (481262.9 3812935 1...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10 POINT Z (481262.6 3812943 2...</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">chm</span> <span class="op">&lt;-</span> <span class="fu"><a href="rasterize.html">rasterize</a></span><span class="op">(</span><span class="fl">1</span>, <span class="st">"max"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">lmf</span> <span class="op">&lt;-</span> <span class="fu">local_maximum_raster</span><span class="op">(</span><span class="va">chm</span>, <span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ans</span> <span class="op">&lt;-</span> <span class="fu"><a href="exec.html">exec</a></span><span class="op">(</span><span class="va">read</span> <span class="op">+</span> <span class="va">chm</span> <span class="op">+</span> <span class="va">lmf</span>, on <span class="op">=</span> <span class="va">f</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># terra::plot(ans$rasterize)</span></span></span>
<span class="r-in"><span><span class="co"># plot(ans$local_maximum, add = T, pch = 19)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Storing LM in UserData.</span></span></span>
<span class="r-in"><span><span class="va">lmf</span> <span class="op">&lt;-</span> <span class="fu">local_maximum</span><span class="op">(</span><span class="fl">5</span>, store_in_attribute <span class="op">=</span> <span class="st">"UserData"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ans</span> <span class="op">&lt;-</span> <span class="fu"><a href="exec.html">exec</a></span><span class="op">(</span><span class="va">read</span> <span class="op">+</span> <span class="va">lmf</span> <span class="op">+</span> <span class="fu"><a href="write.html">write_las</a></span><span class="op">(</span><span class="op">)</span>, on <span class="op">=</span> <span class="va">f</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ans</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $local_maximum</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Simple feature collection with 177 features and 0 fields</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Geometry type: POINT</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dimension:     XYZ</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bounding box:  xmin: 481260 ymin: 3812921 xmax: 481349.8 ymax: 3813011</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> z_range:       zmin: 2.42 zmax: 32.07</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Projected CRS: NAD83 / UTM zone 12N</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> First 10 features:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                              geom</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  POINT Z (481309.9 3812944 2...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2   POINT Z (481294.7 3813011 16)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  POINT Z (481281.9 3813003 2...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  POINT Z (481278.4 3813002 2...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  POINT Z (481307.2 3813000 2...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  POINT Z (481265.3 3812996 1...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7  POINT Z (481261.8 3812999 1...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8  POINT Z (481260.7 3812939 2...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9  POINT Z (481262.9 3812935 1...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10 POINT Z (481262.6 3812943 2...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $write_las</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "/tmp/RtmpNNeXHH/MixedConifer.las"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Storing in an new attribute without geospatial output</span></span></span>
<span class="r-in"><span><span class="va">attr</span> <span class="op">&lt;-</span> <span class="fu"><a href="add_attribute.html">add_extrabytes</a></span><span class="op">(</span><span class="st">"uchar"</span>, <span class="st">"lm"</span>, <span class="st">"local maximum flag"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">lmf</span> <span class="op">&lt;-</span> <span class="fu">local_maximum</span><span class="op">(</span><span class="fl">5</span>, ofile <span class="op">=</span> <span class="st">""</span>, store_in_attribute <span class="op">=</span> <span class="st">"lm"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ans</span> <span class="op">&lt;-</span> <span class="fu"><a href="exec.html">exec</a></span><span class="op">(</span><span class="va">attr</span> <span class="op">+</span> <span class="va">lmf</span> <span class="op">+</span> <span class="fu"><a href="write.html">write_las</a></span><span class="op">(</span><span class="op">)</span>, on <span class="op">=</span> <span class="va">f</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ans</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "/tmp/RtmpNNeXHH/MixedConifer.las"</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jean-Romain Roussel.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

